
- 📅 학습일: 2025-05-19
- 🧩 관련 태그: #ReactQuery 

---

## 📘 주제: 다양한 쿼리 키와 쿼리 함수의 형태


- 특정 사용자한테만 데이터를 보여주는 경우 **계층적으로 쿼리키를 지정**하는 것이 좋다

```jsx
const username = 'codeit'; // 임의로 username을 지정
const {data:postsDataByUsername} = useQuery({
	queryKey : ['posts' , username], // 계층적으로 쿼리키 지정
	queryFn : () => getPostsByUsername(username),
});

return <div>홈페이지</div>

```

=> <mark style="background: #ADCCFFA6;">username에 대한 쿼리만 따로 캐싱된다</mark>


- **다양한 파라미터를 활용**해 쿼리 키를 설정할 수 있다.

```jsx
const {data:postDataByUsername} = useQuery({
	queryKey : ['posts',username,{status:private}],
	queryFn : () => getPrivatePostsByUsername(username)
});
```
=> username과  status가 같을 때만 캐시를 공유함


- 쿼리 키에 있는 값을 아규먼트로 전달하고 싶을 때
```jsx
const {data:postDataByUsername} = userQuery({
	queryKey : ['posts',username],
	queryFn : ({queryKey}) => getPostsByUserId(queryKey[1]),
})
```


- 쿼리 키에서 객체의 특정한 값을 가져와 활용할 수 있다.
```jsx
const username = 'codeit';
const {data:postDataByUsername} = userQuery({
	queryKey : ['posts',{username}],
	qeuryFn : ({queryKey}) => {
		cosnt [key, {username}] = queryKey;
		return getPostByUserId(username);
	}
})
```
=> **queryKey에 객체를 넣고 구조분해 해서 쓰는 이유**
1. <mark style="background: #ADCCFFA6;">파라미터 순서에 의존하지 않게 하기 위해(배열로 전달할 때는 순서가 중요하기 때문)</mark>
2. <mark style="background: #ADCCFFA6;">확장성, 유지보수에 좋기 때문에 사용</mark>


## ❓ 궁금한 점 / 더 알아보기

- 내 피드 구현하기 실습에서
```jsx
 else if (variant === FEED_VARIANT.MY_FEED) {
    const username = 'codeit';
    postsQueryKey = ['posts',{username}]
    postsQueryFn = ({postsQueryKey}) => {
      const [_,{username}] = postsQueryKey;
      return getPostsByUsername(username);
    }
  }
  
  const { data: postsData } = useQuery({
    queryKey: postsQueryKey,
    queryFn: postsQueryFn,
  });

```
이렇게 작성했는데 쿼리 키가 제대로 전달이 안됨

🤔 **왜 전달이 안됐을까?**

- TanStack Query는 `queryFn`에  `{queryKey}`라는 <mark style="background: #ADCCFFA6;">고정된 이름의 프로퍼티</mark>를 넘겨 줌

- 수정
```jsx
postsQueryFn = ({queryKey}) => {
      const [_,{username}] = queryKey;
      return getPostsByUsername(username);
    }

```

## 🔍 참고 자료

