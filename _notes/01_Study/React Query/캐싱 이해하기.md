
- 📅 학습일: 2025-05-19
- 🧩 관련 태그: #ReactQuery #캐시

---

## 📘 주제: 캐싱 이해하기

##### <mark style="background: #D2B3FFA6;">캐시(Cache)</mark>

- 데이터를 미리 복사해 놓는 **임시 저장소**
- 데이터를 저장해 두었다가 백엔드에 요청할 필요 없이 바로 보여줌
- **저장 공간의 크기는 작지만, 데이터를 가져오는 속도가 빠르다**


##### <mark style="background: #D2B3FFA6;">React Query의 캐시</mark>

- 리액트 쿼리의 데이터 라이프 사이클
	- **`useQuery()`** 를 사용한다고 무조건 쿼리 함수가 실행되어 백엔드로부터 데이터를 받아오는 것이 아니다
	- **`useQuery()`** 는 먼저 전달받은 쿼리 키로 캐시에 저장된 데이터가 있는지 확인한다.
	- 쿼리 키로 저장된 데이터가 캐시에 있다면 -> 캐시에 저장되어 있는 데이터를 리턴
	- <mark style="background: #ADCCFFA6;"> fresh </mark><mark style="background: #ADCCFFA6;"> 상태</mark> -> 캐시에 저장되어 있는 데이터를 리턴
	- <mark style="background: #ADCCFFA6;"> stale </mark><mark style="background: #ADCCFFA6;"> 상태</mark> -> 백그라운드에서 refetch 진행 -> 백엔드에서 새로 받아 온 데이터로 기존의 쿼리키로 저장되어 있는 데이터를 갱신
		- stale 상태일 때 refetch를 진행하는 상황
			1. 새로운 쿼리 인스턴스가 마운트 될 때 : `refetchOnMount`
			2. 브라우저 창에 다시 포커스가 갈 때 : `refetchOnWindowFocus`
			3. 네트워크가 다시 연결될 때 : `refetchOnReconnect`
			4. 미리 설정해 둔 refetch interval 시간이 지났을 때 : `refetchInterval`


##### <mark style="background: #D2B3FFA6;">Stale Time</mark>

- **<mark style="background: #ADCCFFA6;">fresh 상태</mark>** : 백엔드에서 막 데이터를 받아와 캐시에 저장된 데이터는 
- <mark style="background: #ADCCFFA6;">stale 상태</mark> :  stale time이라는 특정 시간이 지나면 
- <mark style="background: #ADCCFFA6;">inactive 상태</mark> : 컴포넌트가 언마운트되면(DOM 트리에서 제거되면) 

- stale time
	- 리액트 쿼리에서 디폴트 값은 0
	- 사실상 모든 데이터는 백엔드에서 막 받아왔어도 stale 상태가 되고, 


##### <mark style="background: #D2B3FFA6;">Garbage Collection Time</mark>

- 캐시는 한정된 공간이기 때문에 필요 없는 데이터는 삭제해서 다른 데이터가 사용할 수 있는 공간을 마련해줘야한다.
- inactive 상태의 데이터는 가비지 컬렉션 타임이 지나면 캐시에서 삭제된다. (기본 5분)



##### <mark style="background: #D2B3FFA6;">라이프 사이클 살펴보기</mark>

![[Pasted image 20250519184528.png]]


## ❓ 궁금한 점 / 더 알아보기

- staleTime이 0이면 fresh -> stale -> fetching -> fresh -> stale .... 계속 반복되는 건가..?


## 🔍 참고 자료

