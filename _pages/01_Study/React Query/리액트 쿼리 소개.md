#ReactQuery #서버상태 


### 클라이언트 상태 / 서버 상태 데이터

- **클라이언트 상태 데이터** -> 내 컴퓨터에서만 사용하는 데이터 (React Context, Redux, Recoil) 
- **서버 상태 데이터** -> 서버에서 가져온 데이터 (React Query)

##### ✅ React Query는 **서버 상태 관리 도구**

- 서버에 요청해서 가져오는 데이터 (ex. 게시글 목록, 유저 정보, 댓글)
    
- 서버와의 **비동기 통신 + 캐싱 + 리패치 + 상태 관리**가 목적
    

##### ✅ Redux/Context는 **클라이언트 상태 관리 도구**

- 서버와는 상관없이, 앱 내에서만 쓰는 상태 (ex. 다크모드, 로그인 모달 열림 여부, 폼 입력값 등)
    
- React 컴포넌트끼리 **데이터를 직접 공유하거나** **글로벌한 상태 유지**가 목적

### 서버상태

- 서버 상태 데이터는 **가능한 최신 상태**로 유지되어야 한다.
- 데이터를 받아오는 중에는 어떤 화면을 보여줄 것인지, 서버로부터 받아 온 데이터들은 어떻게 관리할지, 데이터를 주기적으로 받아오려면 어떤식으로 구현해야 할지 등 여러 가지를 고려해야한다

-> 이런 상황을 해결하기 위해 리액트 쿼리가 등장했다.

### React Query

- 데이터를 가져오는 과정에서 ==**로딩과 에러 처리를 쉽게 구현**==할 수 있도록 여러 값을 제공
- 정해진 시간 혹은 조건마다 ==**서버 상태 데이터를 최신으로 가져오는 작업**==도 알아서 진행
- ==**캐시를 사용**==해서 매번 서버에서 데이터를 가져올 필요없이 유저에게 더 빠르게 데이터를 보여줌


##### useQuery와 useMuation의 차이
| 구분         | `useQuery`    | `useMutation`                          |
| ---------- | ------------- | -------------------------------------- |
| 목적         | **데이터 조회**    | **데이터 변경 (쓰기)**                        |
| 자동 리렌더     | yes (캐시 기반)   | no (직접 호출 필요)                          |
| `queryKey` | 필수            | 없음                                     |
| 캐시 갱신      | 내부에서 자동/수동 가능 | 보통 `onSuccess`에서 invalidateQueries로 직접 |
| 예시         | 게시글 불러오기      | 게시글 등록, 삭제                             |
=>“**데이터를 가져오는가? → useQuery**”  
“**서버에 무언가 보내는가? → useMutation**”



## ✅ React Query로 **처리할 수 없는 상태 예시**

| 예시                             | 설명                       |
| ------------------------------ | ------------------------ |
| ✅ 현재 로그인한 유저의 입력 중인 폼 상태       | 서버와 관계없고, 컴포넌트 내에서만 필요   |
| ✅ 다크모드 여부 (`isDarkMode`)       | 유저 설정으로 서버 요청 없이 토글      |
| ✅ 모달 열림 여부 (`isModalOpen`)     | 화면 상 UI 동작일 뿐, 서버랑 관계 없음 |
| ✅ 장바구니에 담긴 상품 (만약 서버에 저장 안 하면) | 로컬에서만 유지하는 경우            |
| ✅ 특정 탭 선택 상태 (`selectedTab`)   | 화면 내 UI 상태 전용            |

이런 상태는 React Query로 관리하면 **오히려 불편**하고 **비효율적**
→ 이런 건 **Redux, Context, 혹은 그냥 `useState`로 처리하는 게 맞음

---

## ✅ React Query가 가장 적합한 데이터 예시

|예시|설명|
|---|---|
|📥 게시글 목록 가져오기|`useQuery(['posts'])`|
|📥 특정 유저 정보 가져오기|`useQuery(['user', userId])`|
|📝 게시글 등록, 수정, 삭제|`useMutation(...)`|
|🔄 좋아요 누르기|`useMutation` 후 invalidate|
|⏱ 자동 새로고침이 필요한 실시간 데이터|`refetchInterval` 활용|
